<%= render :partial=>'sidebar', :locals=>{:val => 1} %>

<!-- 達成率の表を作る -->
<div style="text-align: center;padding:5px;margin-top:10px;"><%= @graph_name + '(' + @item.name +  ')の計画比' %></div>
<table class="table table-striped table-bordered table-condensed">
<% @result_arr.each_with_index do |result, i| %>
  <% if i == 0 %>
    <!-- ヘッダ -->
    <thead>
      <tr>
        <th style="text-align:center">&nbsp;</th>
        <% result['categories'].each do |cate| %>
          <th style="text-align:center"><%= cate.slice(0,4) + '/' + cate.slice(4,2) %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
  <% end %>
  
      <tr>
        <td style="text-align:center"><%= result['dept_name'] %></td>
        <% result['categories'].each_with_index do |cate, i| %>
          <% value = BigDecimal("#{result['this_year_results'][i]/result['this_year_plans'][i]*100}").floor(1) %>

          <% if value >= 100 %>
            <td style="text-align:center;background-color: #a9dba9;"><%= sprintf("%.1f", value)  %></td>
          <% elsif value < 80 %>
            <td style="text-align:center;background-color: lightpink;"><%= sprintf("%.1f", value)  %></td>
          <% else %>
            <td style="text-align:center"><%= sprintf("%.1f", value)  %></td>
          <% end %>

        <% end %>
      </tr>

<% end %>
  </tbody>
</table>




<!-- 折れ線グラフを表示する -->
<% if @group_result %>
  <div style="text-align: right;margin: 0 auto;"><%= high_chart("gropu_result-1", @group_result) %></div>
<% end %>

<!-- 戻り値分　繰り返す -->
<% @result_arr.each_with_index do |result, i| %>

  <div style="text-align: center;margin: 0 auto;">
    
    <div style="text-align: right;margin: 0 auto;margin-bottom: 15px;"><%= high_chart("chart-" + i.to_s, result['graph_plan']) %></div>

    <div style="text-align:left;">
      <a href="javascript:void(0);" onclick="openClose('p_30005','p_30005_detail', 'グラフデータ' );"><span id="p_30005_detail">内訳を表示</span></a>
    </div>

    <div style="text-align: right;margin: 0 auto;margin-bottom: 15px;"><%= high_chart("cumulative-" + i.to_s, result['graph_cumulative']) %></div>

    <table class="table table-striped table-bordered table-condensed" id="p_30005">
      <thead>
        <tr>
          <th style="text-align:center">&nbsp;</th>
          <% result['categories'].each do |cate| %>
            <th style="text-align:center"><%= cate %></th>
          <% end %>
        </tr>
      </thead>>
      <tbody>
        <tr>
          <td style="text-align:center">計画</td>
          <% sum = 0 %>
          <% result['this_year_plans'].each do |rec| %>
            <td style="text-align:center"><%= rec %></td>
            <% sum = sum + rec %>
          <% end %>
        </tr>
        <tr>
          <td style="text-align:center">実績</td>
          <% sum = 0 %>
          <% result['this_year_results'].each do |rec| %>
            <td style="text-align:center"><%= rec %></td>
            <% sum = sum + rec %>
          <% end %>
        </tr>
        <tr>
          <% sum = 0 %>
          <td style="text-align:center">前年実績</td>
          <% result['prev_year_results'].each do |rec| %>
            <td style="text-align:center"><%= rec %></td>
            <% sum = sum + rec %>
          <% end %>
        </tr>
      </tbody>

    </table>

    <% if result['graph_years'] %>
      <div style="text-align: right;margin: 0 auto;"><%= high_chart("years-" + i.to_s, result['graph_years']) %></div>
    <% end %>

  </div>

<% end %>



<script type="text/javascript">
  <!--
    openClose('p_30005','p_30005_detail', 'グラフデータ');
  //-->
</script>
